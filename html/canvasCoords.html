<html>
<center><canvas id='xyz' width="600" height="300" style='border:1px solid red;'></canvas></center><br/>
<button onclick='addRect()'>Rect</button><br/>
<textarea id='logit' rows=15 style='width:100%;' placeholder='Logging textarea!'></textarea>
<script>
xyz.addRect = function(rect){
	const ctx = this.getContext('2d');
	ctx.rect(rect.x,rect.y,rect.width,rect.height);
	ctx.stroke();
};
logit.log = function(s){
	this.value += s + '\n';
}
function getRelativeCoords(event) {
	return { x: event.offsetX, y: event.offsetY };
}
function clickLog(event){
	const coords = getRelativeCoords(event);
	logit.value += `(x, y) = (${coords.x}, ${coords.y})\n`;
}

class Rect {
	constructor(x,y,width,height){
		this.x = x;
		this.y = y;
		this.width = width;
		this.height = height;
	}
	toString(){
		return `Rectangle (x,y) = (${this.x},${this.y}) of (w,h) = (${this.width},${this.height})`;
	}
}
class XYc {
	constructor(x,y){
		this.x = x;
		this.y = y;
	}
	toString(){
		return `${this.x}, ${this.y}`;
	}
}
class TwoClicks {
	constructor(){
		this.xy1 = null;
		this.xy2 = null;
	}
	addClick(xy){
		this.xy1 = this.xy2;
		this.xy2 = xy;
	}
}

function addRect(){
	if (storedLastClicks.xy1 && storedLastClicks.xy2){
		logit.log(`${storedLastClicks.xy1} , ${storedLastClicks.xy2}\n`);
		xyz.addRect(storedLastClicks.xy1.x,storedLastClicks.xy1.y, storedLastClicks.xy2.x-storedLastClicks.xy1.x,storedLastClicks.xy2.y-storedLastClicks.xy1.y)
	}
}
const storedLastClicks = new TwoClicks();
logit.value = '';
xyz.addEventListener('click', clickLog);
let addToStoredLastClicks = function(event){
	const coords = getRelativeCoords(event);
	storedLastClicks.addClick(new XYc(coords.x,coords.y));
};

function activateTool(event){
	const coords = getRelativeCoords(event);
	let rect = new Rect(lastClick.x
		, lastClick.y
		, coords.x-lastClick.x
		, coords.y-lastClick.y
	);
	xyz.addRect(rect);
	myshapes.addShape(rect);
	logit.log(rect);
}
//xyz.addEventListener('click', clickLog);
//xyz.addEventListener('click', addToStoredLastClicks);
const lastClick = new XYc(null,null);
let setLastClick = function(event){
	const coords = getRelativeCoords(event);
	lastClick.x = coords.x;
	lastClick.y = coords.y;
};

class MyShapes {
	constructor(){
		this.data = [];
	}
	addShape(shape){
		this.data.push(shape);
	}
}

const myshapes = new MyShapes();

xyz.addEventListener('mousedown',clickLog);
xyz.addEventListener('mousedown', setLastClick);
xyz.addEventListener('mouseup', activateTool);

</script>
</html>