<html>
<center><canvas id='xyz' width="600" height="300" style='border:1px solid red;'></canvas></center><br/>
<button onclick='tool="rect"'>Rect</button>
<button onclick='tool="circle"'>Circle</button><br/>
<textarea id='logit' rows=15 style='width:100%;' placeholder='Logging textarea!'></textarea>
<script>
xyz.addRect = function(rect){
	const ctx = this.getContext('2d');
	ctx.rect(rect.x,rect.y,rect.width,rect.height);
	ctx.stroke();
};
xyz.addCircle = function(circle){
	const ctx = this.getContext('2d');
	ctx.beginPath();
	ctx.arc(circle.x, circle.y, circle.r, 0, 2 * Math.PI);
	ctx.stroke();
};
logit.log = function(s){
	this.value += s + '\n';
}
function getRelativeCoords(event) {
	return { x: event.offsetX, y: event.offsetY };
}
function clickLog(event){
	const coords = getRelativeCoords(event);
	logit.value += `(x, y) = (${coords.x}, ${coords.y})\n`;
}

class Rect {
	constructor(x,y,width,height){
		this.x = x;
		this.y = y;
		this.width = width;
		this.height = height;
	}
	toString(){
		return `Rectangle (x,y) = (${this.x},${this.y}) of (w,h) = (${this.width},${this.height})`;
	}
}
class Circle {
	constructor(x,y,r){
		this.x = x;
		this.y = y;
		this.r = r;
	}
	toString(){
		return `Circle (x,y,r) = (${this.x},${this.y},${this.r})`;
	}
}

class XYc {
	constructor(x,y){
		this.x = x;
		this.y = y;
	}
	toString(){
		return `${this.x}, ${this.y}`;
	}
}
class TwoClicks {
	constructor(){
		this.xy1 = null;
		this.xy2 = null;
	}
	addClick(xy){
		this.xy1 = this.xy2;
		this.xy2 = xy;
	}
}

const storedLastClicks = new TwoClicks();
logit.value = '';
xyz.addEventListener('click', clickLog);
let addToStoredLastClicks = function(event){
	const coords = getRelativeCoords(event);
	storedLastClicks.addClick(new XYc(coords.x,coords.y));
};

function mkShape(xy1,xy2,tool){
	let shape;
	switch (tool){
		case 'rect':
			shape = new Rect(xy1.x
				, xy1.y
				, xy2.x - xy1.x
				, xy2.y - xy1.y
			);
			xyz.addRect(shape);
			break;
		case 'circle':
			shape = new Circle(xy2.x
				, xy2.y
				, Math.sqrt( Math.pow(xy2.x-xy1.x,2) + Math.pow(xy2.y-xy1.y,2))
			);
			xyz.addCircle(shape);
			break;
	}
	return shape;
}

function activateTool(event){
	const coords = getRelativeCoords(event);
	let shape = mkShape(coords, lastClick, tool);
	myshapes.addShape(shape);
	logit.log(shape);
}
//xyz.addEventListener('click', clickLog);
//xyz.addEventListener('click', addToStoredLastClicks);
const lastClick = new XYc(null,null);
let setLastClick = function(event){
	const coords = getRelativeCoords(event);
	lastClick.x = coords.x;
	lastClick.y = coords.y;
};

class MyShapes {
	constructor(){
		this.data = [];
	}
	addShape(shape){
		this.data.push(shape);
	}
}

const myshapes = new MyShapes();
let tool = 'rect';
xyz.addEventListener('mousedown',clickLog);
xyz.addEventListener('mousedown', setLastClick);
xyz.addEventListener('mouseup', activateTool);

</script>
</html>