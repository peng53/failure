<html>
<style>
#output {
	overflow: auto;
}
textarea {
	width: 100%;
	resize: vertical;
}
span {
	font-family: monospace;
	font-size: 2em;
}
#output { 
	white-space: pre;
}
</style>
<fieldset>
<legend>Descriptors</legend>
<textarea id='descriptors' rows=8 ></textarea>
</fieldset>
<fieldset>
<legend>Text</legend>
<textarea id='alltext' rows=4 ></textarea>
</fieldset>
<button onclick='parseText()'>Parse</button></div>
<div id='output'></div>
<script>
const desc = document.querySelector('#descriptors');
const itext = document.querySelector('#alltext');
const outdiv = document.querySelector('#output');
let glinedefs = null;
function splitParse(x){
	const [k,v] = x.split('=');
	return [k,parseInt(v)];
}
function parseDesc(){
	let desclines = desc.value.split('\n');
	let linedefs = {};
	for (let line of desclines){
		let linecols = line.split(',');
		let [id,ind] = splitParse(linecols[0]);
		let cols = new Map();
		for (let i=1;i<linecols.length;i++){
			let [colname,len] = splitParse(linecols[i]);
			cols.set(colname,len);
		}
		linedefs[id] = {at:ind, cols:cols};
	}
	return linedefs;
}
function idLine(line, linedefs){
	for (let def in linedefs){
		if (line[linedefs[def].at] == def){
			return def;
		}
	}
	return null;
}
function parseText(){
	let linedefs = parseDesc();
	glinedefs = linedefs;
	let lines = itext.value.split('\n');
	outdiv.textContent ='';
	let linect = 0;
	for (let line of lines){
		let def = idLine(line,linedefs);
		let outline = outdiv.appendChild(document.createElement('div'));
		if (def == null){
			outline.appendChild(document.createElement('span')).textContent = line;
		} else {
			outline.dataset.ltype = def;
			outline.classList.add('line');
			let i=0;
			outline.appendChild(document.createElement('h3')).textContent = `Line: ${linect} Type: ${def}`;
			let ul = outline.appendChild(document.createElement('ul'));
			for (let [col,len] of linedefs[def].cols){
				let cell = outline.appendChild(document.createElement('li'));
				cell.appendChild(document.createElement('b')).textContent = col;
				cell.appendChild(document.createTextNode(':' + line.substring(i,i+len)));
				cell.title = col;
				i += len;
			}
			if (i+1<line.length){
				let cell = outline.appendChild(document.createElement('li'));
				cell.textContent = line.substring(i);
			}
		}
		linect++;
	}
}
descriptors.value='\
X=0,Type=1,Room=5,Spec=10,AccessLevel=2\
\nY=0,Type=1,Fname=25,LName=25,Id=5\
\n1=0,Type=1,A=1,B=1,C=1,D=1';
alltext.value = '\
X08075SPEC_12345AR\
\nY                  Michael                   Vaughn50214\
\n1ABCD';
</script>
</html>