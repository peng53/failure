<html>
<head>
<title>Scatter!!</title>
<style>
	body {
		margin: 0;
		background: #fff;
	}
	canvas {
		position: absolute;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		margin: auto;
		z-index: -1;
	}
	h3 {
		margin: 0;
	}
	#topmenu {
		background: #eee;
		width: 100%;
	}
	#sidemenu button {
		border: 0;
	}
	#controls, #data {
		float: left;
		background: #eee;
		padding: 0.5em;
		border: 1px outset gray;
	}
	#controls input {
		width: 4em;
	}
	#data textarea {
		width: 100%;
		height: 3em;
		resize: vertical;
	}
	#data select {
		width: 100%;
		height: 12em;
	}
</style>
<script src='scatterplot.js'></script>
</head>
<div id='topmenu'>
<button onclick='showMenu("controls")'>CONTROLS</button>
<button onclick='showMenu("data")'>DATA</button>
</div>
<div id='controls'>
	<h3>Controls</h3>
	XView<br /><input id='xviewL' type='number' step='any' /><input id='xviewR' type='number' step='any' /><br />
	YView<br /><input id='yviewL' type='number' step='any' /><input id='yviewR' type='number' step='any' /><br />
	Grid<br /><input id='gridx' type='number' step='any' min=0 /><input id='gridy' type='number' step='any' min=0 /><br />
	<button onclick='drawGraph(maingraph,can);'>Draw</button><button onclick=''>Auto</button>
</div>
<div id='data'>
	<h3>Data</h3>
	<label for='points'>Input<br />
	<textarea id='points'>
-4, -64,
-3, -27,
-2, -8,
-1, -1,
0, 0,
1, 1,
2, 8,
3, 27,
4, 64
	</textarea></label><br />
	<button onclick='addPoints(maingraph)'>Add</button><br />
	<hr />
	<label for='pointsList'>Displayed<br />
	<select id='pointsList' name='point' multiple></select></label><br />
	<button onclick=''>Pop</button><br />
</div>
<canvas id='mycan' width='400px' height='300px'></canvas>

<script>
	var currentMenu = undefined;
	function showMenu(menu){
		if (currentMenu === menu){
			toggleHide(currentMenu);
			currentMenu = undefined;
		} else {
			if (!(currentMenu === undefined)){
				toggleHide(currentMenu);
			}
			currentMenu = menu;
			toggleHide(currentMenu);
		}
	}
	function toggleHide(ele){
		let div = document.getElementById(ele);
		div.style.display = div.style.display == "none" ? "block" : "none";
	}

	function retrieveArgs(){
		let xview, yview, gridxy;
		let nm = [getValueFrom('xviewL'), getValueFrom('xviewR')];
		if (nm[0] && nm[1]){
			nm = nm.map(Number);
			if (nm[0] < nm[1]){
				xview = nm;
			}
		}
		nm = [getValueFrom('yviewL'), getValueFrom('yviewR')];
		if (nm[0] && nm[1]){
			nm = nm.map(Number);
			if (nm[0] < nm[1]){
				yview = nm;
			}
		}
		nm = [getValueFrom('gridx'), getValueFrom('gridy')];
		if (nm[0] && nm[1]){
			nm = nm.map(Number);
			if (nm[0]>0 && nm[1]>0){
				gridxy = nm;
			}
		}
		return [xview, yview, gridxy];
	}
	function drawGraph(graph, can){
		let [xview, yview, gridxy] = retrieveArgs();

		if (xview === undefined){
			xview = [graph.points[0].x, graph.points[maingraph.points.length-1].x];
		}
		if (yview === undefined){
			yview = getMinAndMax(graph.points, (point) => point.y);
		}
		let xscale = calculateScale(xview, can.width);
		let yscale = calculateScale(yview, can.height);
		canvasBg(can);
		if (gridxy){
			gridLines(xscale, xview, gridxy[0], yscale, yview, gridxy[1], can);
		}
		originLines(xscale, xview, yscale, yview, can);
		plotPoints(graph.points, xscale, yscale, xview, yview, can);
	}
	
	function getValueFrom(name){
		return document.getElementById(name).value;
	}
	function addPoints(graph){
		let values = document.getElementById('points').value.split(',').map(Number);
		for (let i=0, l=values.length; i<l; i+=2){
			if (values[i] && values[i+1]){
				graph.points.push(new Point(values[i], values[i+1]));
			}
		}
		graph.points.sort((a,b) => a.x-b.x);
	}

	document.getElementById('controls').style.display = 'none';
	document.getElementById('data').style.display = 'none';

	var maingraph = new Graph();
	var can = document.getElementById('mycan');


</script>
</html>

