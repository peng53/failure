<html>
<style>
body {
	font-family: monospace;
	font-size: 1.2em;
}
details {
}
.nobullet {
}
summary {
		list-style: none;
		font-weight: 600;
}
summary {
	color: #3e0000;
}
summary:hover {
	color: red;

}
.key {
	font-weight: 600;
}
.t_boolean {
	color: indigo;
}
.t_null {
	color: gray;
}
.t_string {
	color: maroon;
}
.t_number {
	color: navy;
}
</style>
<script>
'use strict';
// json tree

function jtype(v){
	let t = typeof v;
	if (t=='object'){
		if (v == null){
			return 'null';
		} else if (Array.isArray(v)){
			return 'array';
		} else {
			return 'object';
		}
	}
	return t;
}

function renderTree(jtext, output){
	const j = JSON.parse(jtext.value);
	let item,type,snode,key,val;
	const onode = document.createElement('ul');
	const stk = [{key:'Json', node:onode, json:j}];
	while (stk.length>0){
		item = stk.pop();
		snode = undefined;
		type = jtype(item.json);
		switch (type){
			case 'object':
				snode = item.node.appendChild(document.createElement('li'));
				snode.classList.add('nobullet');
				snode = snode.appendChild(document.createElement('details'));
				snode.open = true;
				snode.appendChild(document.createElement('summary')).textContent = item.key+'{}';
				snode = snode.appendChild(document.createElement('ul'));
				for (const k of Object.keys(item.json).reverse()){
					stk.push({key:k, node:snode, json:item.json[k]});
				}
				break;
			case 'array':
				snode = item.node.appendChild(document.createElement('li'));
				snode.classList.add('nobullet');
				snode = snode.appendChild(document.createElement('details'));
				snode.open = true;
				snode.appendChild(document.createElement('summary')).textContent = `${item.key}[${item.json.length}]`;
				snode = snode.appendChild(document.createElement('ol'));
				snode.start = 0;
				for (let m=item.json.length-1;m>=0;--m){
					stk.push({key:'', node:snode, json:item.json[m]});
				}
				break;
			default:
				snode = item.node.appendChild(document.createElement('li'));
				if (item.key.length>0){
					//snode.textContent = `${item.key} : ${JSON.stringify(item.json)}`;
					key = snode.appendChild(document.createElement('span'));
					key.classList.add('key');
					key.textContent = item.key;
					snode.appendChild(document.createTextNode(': '));
				} else {
					//snode.textContent = JSON.stringify(item.json);
				}
				val = snode.appendChild(document.createElement('span'));
				val.textContent = JSON.stringify(item.json);
				val.classList.add('val','t_'+type);
				//item.node.appendChild(document.createElement('br'));
				break;
		}
	}
	output.appendChild(onode);
}

</script>
<textarea id='lefttext'>
{
"a": 1,
"b": "two",
"c": [3],
"d": {
	"e": [4,53],
	"j": 512
	},
"k": null
}
</textarea>
<div id='output'></div>
<button onclick='renderTree(lefttext,output)'>Render</button>
</html>
