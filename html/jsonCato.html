<html>
<style>
#formout {
	width: 100%;
}
#formout input {
	width: 100%;
}
#tprops td {
	color: green;
}
#entries th {}
#sidebar h3 {
	margin: 0;
}
#sidebar {
	float: left;
	width: 200px;
	margin: 0;
	overflow: auto;
	height: 100%;
}
#entries {
	
}
body {
	margin: 0;
}
</style>
<script>
class FormMaker {
	constructor(out){
		this.outH = out;
		this.props = [];
		this.propsSet = {};
	}
	addprop(name){
		if (name.length < 0 || name in this.propsSet){
			alert('Name too short or already added');
			return;
		}
		const colNum = this.props.length;
		this.props.push(name);
		this.propsSet[name] = colNum;
		const div = document.createElement('div');
		const lab = document.createElement('span');
		lab.textContent = name;
		div.appendChild(lab);
		div.appendChild(document.createElement('br'));
		div.appendChild(document.createElement('input'));
		this.outH.appendChild(div);
		tprops.insertCell(-1).appendChild(document.createTextNode(name));
	}
}
function additem(to, formmkObj, from){
	const obj = {};
	const fromInp = from.getElementsByTagName('input');
	const row = entries.insertRow(-1);
	for (let i=0; i<formmkObj.props.length; ++i){
		obj[formmkObj.props[i]] = fromInp[i].value;
		row.insertCell(-1).appendChild(document.createTextNode(fromInp[i].value));
		fromInp[i].value = '';
	}
	to.push(obj);
}
function exportItems(items){
	const link = document.createElement('a');
	link.href = 'data:attachment/text,' + encodeURI(JSON.stringify(items));
	link.target = '_blank';
	link.download = 'out.json';
	link.click();
}
function importItems(text, to, myform){
	const data = JSON.parse(text);
	let item;
	let row;
	let cell;
	for (let i=0;i<data.length; ++i){
		to.push(data[i]);
		item = {};
		for (let key in data[i]){
			if (key in myform.propsSet==false){
				myform.addprop(key);
			}
			console.log(key,':',data[i][key], myform.propsSet[key]);
			item[key] = data[i][key];
		}
		row = entries.insertRow(-1);
		for (let key in myform.propsSet){
			cell = row.insertCell(-1);
			if (key in item){
				cell.appendChild(document.createTextNode(item[key]));
			} else {
				cell.appendChild(document.createTextNode());
			}
		}
		to.push(item);
	}
}
const jsonOut = [];

</script>
<div id='sidebar'>
<div id='formmaker'>
<input id='propname' /><br />
<button onclick='addprop(propname.value)'>Add Property</button>
</div>
<hr />
<div id='formout'>
<h3>Properties</h3>

</div>
<button onclick='additem(jsonOut, myform, formout)'>Add Item</button><br />
<textarea id='rawjson'>

</textarea>
<button onclick='importItems(rawjson.value, jsonOut, myform);'>Import Items</button>
</div>

<table id='entries'>
<thead>
<tr><th colspan='100%'>Entries</td></tr>
<tr id='tprops'></tr>
</thead>
</table>
<button onclick='exportItems(jsonOut)'>Export Items</button>
<script>
const myform = new FormMaker(formout);
function addprop(name){
	myform.addprop(name);
}
</script>
</html>