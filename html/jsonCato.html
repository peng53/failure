<html>
<style>
#formout {
	width: 100%;
}
#formout input {
	width: 100%;
}
#tprops td {
	color: green;
}
#entries th {}
#sidebar h3 {
	margin: 0;
}
#sidebar {
	float: left;
	width: 200px;
	margin: 0;
	overflow: auto;
	height: 100%;
}
#entries {
	
}
body {
	margin: 0;
}
</style>
<script>
'use strict';
class DynaForm {
	constructor(div,dtable){
		this.div = div;
		this.dtable = dtable;
	}
	addprop(name){
		const div = document.createElement('div');
		const lab = document.createElement('span');
		lab.textContent = name;
		div.appendChild(lab);
		div.appendChild(document.createElement('br'));
		div.appendChild(document.createElement('input'));
		this.div.appendChild(div);
	}
	additem(to){
		const item = {};
		const inputs = this.div.getElementsByTagName('input');
		this.dtable.cols.forEach(
			(v,k) => item[k] = inputs[v].value
		);
		this.dtable.addRow(item);
		to.push(item);
	}
}
class DataTable {
	constructor(table){
		this.table = table;
		this.cols = new Map();
	}
	prop(name){
		return (this.cols.has(name) ? this.cols.get(name) : -1);
	}
	addCol(name){
		if (this.cols.has(name)){
			return -1;
		}
		console.log('add col', name);
		const n = this.cols.size;
		this.cols.set(name, n);
		document.getElementById('tprops').insertCell(-1).appendChild(document.createTextNode(name));
		return n;
	}
	addRow(item){
		const row = this.table.insertRow(-1);
		console.log(item);
		this.cols.forEach(
			(v,k) => row.insertCell(-1).appendChild(
				document.createTextNode(
					(k in item) ? item[k] : ''
				)
			)
		);
	}
}

function exportItems(items){
	const link = document.createElement('a');
	link.href = 'data:attachment/text,' + encodeURI(JSON.stringify(items));
	link.target = '_blank';
	link.download = 'out.json';
	link.click();
}

function importItems(text, to, myform){
	if (text.length < 1){
		alert('0-len JSON data input');
		return;
	}
	const data = JSON.parse(text);
	let item;
	for (const ditem of data){
		to.push(ditem);
		item = {};
		for (const key in ditem){
			if (myform.dtable.prop(key) == -1){
				myform.addprop(key);
				myform.dtable.addCol(key);
			}
			item[key] = ditem[key];
		}
		myform.dtable.addRow(item);
	}
}
const jsonOut = [];

</script>
<div id='sidebar'>
<div id='formmaker'>
<input id='propname' /><br />
<button onclick='addprop(propname.value)'>Add Property</button>
</div>
<hr />
<div id='formout'>
<h3>Properties</h3>

</div>
<button onclick='myform.additem(jsonOut)'>Add Item</button><br />
<textarea id='rawjson'>

</textarea>
<button onclick='importItems(rawjson.value, jsonOut, myform);'>Import Items</button>
</div>

<table id='entries'>
<thead>
<tr><th colspan='100%'>Entries</td></tr>
<tr id='tprops'></tr>
</thead>
</table>

<button onclick='exportItems(jsonOut)'>Export Items</button>

<script>
const mytable = new DataTable(entries);
const myform = new DynaForm(formout, mytable);
function addprop(name){
	if (name.length==0){
		alert('Property name too short!');
		return;
	}
	if (mytable.prop(name) !== -1){
		alert('Property already exists!');
		return;
	}
	myform.addprop(name);
	mytable.addCol(name);
}
</script>
</html>