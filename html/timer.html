<html>
<head>
<meta charset='utf-8'/>
<style>
	#timeleft {
		margin: 0 auto;
		text-align: center;
		font-size: 4em;
	}
	#timeleft input {
		font-size: 1em;
		font-family: monospace;
		background: orange;
		text-align: center;
		-webkit-appearance: none;
		-moz-appearance: textfield;
		margin: 0;
	}
	#controls,#addtimecontrols  {
		margin: 0 auto;
		text-align: center;
		font-size: 2em;
	}
	#ssbutton, #addtimecontrols button {
		font-size: 1em;
		font-family: monospace;
	}
	#ssbutton {
		background: red;
	}
	#addtimecontrols button {
		background: green;
		font-size: 0.5em;
		color: white;
	}
	button, input {
		border-radius: 5px;
		padding: 0.5em;
		border: none;
	}
</style>
</head>
<div id='widget'>
<div id='timeleft'>
<input id='hleft' type=number value=0 min=0 max=99 size=2 onblur='setEndTime()' />:
<input id='mleft' type=number value=0 min=0 max=59 size=2 onblur='setEndTime()' />.
<input id='sleft' type=number value=0 min=0 max=59 size=2 onblur='setEndTime()' />
<button id='ssbutton' onclick='startTime();'>â–º</button>
</div>
<br />
<div id='controls'></div>
<br />
<div id='addtimecontrols'>
<button id='add5' onclick='addM(5)'>&#43;5mins</button>
<button id='add10' onclick='addM(10)'>&#43;10mins</button>
<button id='add30' onclick='addM(30)'>&#43;30mins</button>

</div>
<script>
var timeEvent = undefined;
var endTime = undefined;
function startTime(){
	if (timeEvent){
		clearInterval(timeEvent);
	}
	timeEvent = setInterval(updateTime, 1000);
	updateTime();
	ssbutton.innerText = '\u25A0';
	ssbutton.onclick = stopTime;
	setEndTime(0, 0, 0);
}
function setEndTime(hrs=0, mins=0, secs=0){
	let nowTime = new Date();
	let diff = (hrs+Number(hleft.value))*3600000 + (mins+Number(mleft.value))*60000 + (secs+Number(sleft.value))*1000;
	endTime = new Date(nowTime.getTime() + diff);
}
function stopTime(){
	if (timeEvent){
		clearInterval(timeEvent);
		timeEvent = undefined;
		ssbutton.innerText = '\u25BA';
		ssbutton.onclick = startTime;
	}
}
function resyncTime(){
	let nowTime = new Date();
	let diff = endTime-nowTime;
	hleft.value = Math.floor(diff/3600000);
	diff %= 3600000;
	mleft.value = Math.floor(diff/60000);
	diff %= 60000;
	sleft.value = Math.floor(diff/1000);
}
function updateTime(){
	console.log("CALL!");
	if (sleft.value > 0){
		sleft.value--;
	} else if (mleft.value > 0){
		mleft.value--;
		sleft.value = 59;
		resyncTime();
	} else if (hleft.value > 0){
		hleft.value--;
		mleft.value = 59;
		sleft.value = 59;
		resyncTime();
	} else {
		clearInterval(timeEvent);
		timeEvent = undefined;
	}
}
function addM(mins){
	setEndTime(0,mins,0);
	resyncTime();
	//let nmin = Number(mleft.value)+Number(mins);
	//if (nmin >= 60){
	//	let nhrs = Math.floor(nmin/60) + Number(hleft.value);
	//	nmin %= 60;
	//	hleft.value = nhrs;
	//}
	//mleft.value = nmin;
	//resyncTime();
}
</script>
</html>