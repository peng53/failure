<html>
<head>
<meta charset='utf-8'/>
<style>
	body {
		margin: 0;
		font-size: 1em;
		font-family: monospace;
		}
	#widget {
		padding: 1em;
		border: 1px grey solid;
		margin: 0;
		font-size: 1em;
		font-family: monospace;
	}
	#timeleft {
		margin: 0 auto;
		text-align: center;
	}
	#timeleft input {
		text-align: center;
		-webkit-appearance: none;
		-moz-appearance: textfield;
		margin: 0;
	}
	#controls,#addtimecontrols  {
		margin: 0 auto;
		text-align: center;
	}
	#ssbutton, #addtimecontrols button {
	}
	#addtimecontrols button {
	}
	button, input {
		border-radius: 5px;
		padding: 0.5em;
		border: none;
		font-family: monospace;
	}
	.secstyle {
		background: #515151;
		color: white;
	}
	.minstyle {
		background: #313131;
		color: white;
	}
	.hrstyle {
		background: #111;
		color: white;
	}
	.smallft {
		font-size: 2em;
	}
	.medft {
		font-size: 4em;
	}
</style>
<script>
var timeEvent = undefined;
var endTime = undefined;
function startTime(){
	if (sleft.value === '0' && mleft.value === '0' && hleft.value === '0'){
		return;
	}
	if (timeEvent){
		clearInterval(timeEvent);
	}
	timeEvent = setInterval(updateTime, 1000);
	updateTime();
	ssbutton.innerText = '\u25A0';
	ssbutton.onclick = stopTime;
	setEndTime(0, 0, 0);
}
function setEndTime(hrs=0, mins=0, secs=0){
	let nowTime = new Date();
	let diff = (hrs+Number(hleft.value))*3600000 + (mins+Number(mleft.value))*60000 + (secs+Number(sleft.value))*1000;
	endTime = new Date(nowTime.getTime() + diff);
}
function stopTime(){
	if (timeEvent){
		clearInterval(timeEvent);
		timeEvent = undefined;
		ssbutton.innerText = '\u25BA';
		ssbutton.onclick = startTime;
	}
}
function resyncTime(){
	let nowTime = new Date();
	let diff = endTime-nowTime;
	hleft.value = Math.floor(diff/3600000);
	diff %= 3600000;
	mleft.value = Math.floor(diff/60000);
	diff %= 60000;
	sleft.value = Math.floor(diff/1000);
}
function updateTime(){
	console.log("CALL!");
	if (sleft.value > 0){
		sleft.value--;
	} else if (mleft.value > 0){
		mleft.value--;
		sleft.value = 59;
		resyncTime();
	} else if (hleft.value > 0){
		hleft.value--;
		mleft.value = 59;
		sleft.value = 59;
		resyncTime();
	} else {
		clearInterval(timeEvent);
		timeEvent = undefined;
	}
}
function addTime(hrs, mins, secs){
	setEndTime(hrs,mins,secs);
	resyncTime();
}
</script>
</head>
<body>
<div id='widget'>
<div id='timeleft'>
<input class='hrstyle medft' id='hleft' type=number value=0 min=0 max=99 size=2 onblur='setEndTime(0,0,0)' />:
<input class='minstyle medft' id='mleft' type=number value=0 min=0 max=59 size=2 onblur='setEndTime(0,0,0)' />.
<input class='secstyle smallft' id='sleft' type=number value=0 min=0 max=59 size=2 onblur='setEndTime(0,0,0)' />
<button class='hrstyle' id='ssbutton' onclick='startTime();'>â–º</button>
</div>
<br />
<div id='controls'></div>
<br />
<div id='addtimecontrols'>
<button class='hrstyle' onclick='addTime(hrs=1, mins=0, secs=0)'>&#43;1</button>
<button class='minstyle' onclick='addTime(hrs=0, mins=30, secs=0)'>&#43;30</button>
<button class='minstyle' onclick='addTime(hrs=0, mins=10, secs=0)'>&#43;10</button>
<button class='minstyle' onclick='addTime(hrs=0, mins=5, secs=0)'>&#43;5</button>
<button class='secstyle' onclick='addTime(hrs=0, mins=0, secs=30)'>&#43;30</button>
<button class='secstyle' onclick='addTime(hrs=0, mins=0, secs=10)'>&#43;10</button>
</div>
</div>
</body>
</html>