<html>
	<head>
		<style>
			body {
				background: #fff;
				color: #000;
				font-family: monospace;
			}
			table th, table td {
				text-align: center;
			}
			input.code, input.start, input.stop, input.diff {
				text-align: right;
				background: #fff;
				color: #000;
			}
			input.code {
				width: 2em;
			}
			input.start, input.stop, input.diff {
				width: 3em;
			}
			div#times table {
				float: left;
				border: 1px solid #000;
				border-collapse: collapse;
			}
			input {
				border: 0;
			}
			input:hover {
				background: #ccc;
			}
			table tr {
				border: 1px solid #000;
			}
		</style>
		<script>
			var starts, stops, diffs, codes;
			function getDiff(i){
				let d1 = starts[i].value.split(':',2).map(Number);
				let d2 = stops[i].value.split(':', 2).map(Number);
				let diff;
				diff = d2[0]-d1[0];
				console.log(d1);
				console.log(d2);
				if (d1[0] > d2[0]){
					diff += 12;
				}
				diff += (d2[1]-d1[1])/60;
				return diff.toFixed(2);
			}
			function calc(i){
				console.log(i);
				if (starts[i].value.length == 0 || stops[i].value.length == 0 ){
					return;
				}
				
				diffs[i].value = getDiff(i);

				if (i<2){
					return;
				}
				if (starts[i-1].value.length != 0 || stops[i-2].value.length == 0){
					return;
				}
				// Attempt to find inbetween row above
				stops[i-1].value = starts[i].value;
				starts[i-1].value = stops[i-2].value;
				diffs[i-1].value = getDiff(i-1);
				codes[i-1].value = 'ATO';
			}
			function createTimesTable(start, rows){
				let timesdiv = document.getElementById('times');
				let table = document.createElement('table');
				table.innerHTML = "<tr><th>Code</th><th>Start</th><th>Stop</th><th>Hrs</th></tr>";
				timesdiv.appendChild(table);
				let stop = rows+start;
				for (let i=start; i<stop; ++i){
					let row = table.insertRow(-1);
					row.innerHTML = "<tr><td><input class='code' maxlength=3 /></td><td><input class='start' maxlength=5 /></td><td><input class='stop' maxlength=5 onblur=calc("+i+") /></td><td><input class='diff' maxlength=5 /></td></tr>";
				}
			}
			function main(){
				createTimesTable(0,10);
				createTimesTable(10,10);
				
				diffs =  document.getElementsByClassName('diff');
				starts = document.getElementsByClassName('start');
				stops = document.getElementsByClassName('stop');
				codes = document.getElementsByClassName('code');
				
				let cnt = codes.length;
				for (let i=0; i<cnt; ++i){
					codes[i].value = i+100;
				}
			}
			window.onload = main;
		</script>
	</head>
	<body>
	<div id='times'>
		<!--
	<table>
	<tr>
		<th>Code</th>
		<th>Start</th>
		<th>Stop</th>
		<th>Hrs</th>
	</tr>
	<tr><td><input class='code' /></td><td><input class='start' /></td><td><input class='stop' /></td><td><input class='diff' /></td></tr>
	</table>
	-->
	</div>
	</body>
</html>
