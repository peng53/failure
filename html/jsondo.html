<script>
/*
function usedata(data){
	if (data){
		const d = JSON.parse(data);
	}
}
const url = '';
const j = new XMLHttpRequest();
j.onreadystatechange = function(){
	if (this.readyState == 4){
		if (this.status == 200){
			usedata(this.responseText);
		}
	}
};
j.open('GET', url);
j.send();
*/
</script>
<table id='outdata'>
<thead>
<tr style='font-weight:bold'>
	<th>Lanes</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<script>
function rowCols(row, colcount, data){
	for (let i=0;i<colcount;++i){
		row.insertCell(-1).appendChild(document.createTextNode((data.length > i) ? data[i] : ''));
	}
}
function randArray(cnt){
	const r = [];
	for (let i=0;i<cnt;++i){
		r.push(Math.random());
	}
	return r;
}


const colnums = new Map();
{
	const colheader = document.querySelector('#outdata thead tr');
	const colnames = ['RedCnt','BlueCnt','YellowCnt','GreenCnt'];
	for (let i=0;i<colnames.length;++i){
		colnums.set(colnames[i], i+1);
		colheader.appendChild(document.createElement('th')).appendChild(document.createTextNode(colnames[i]));
	}
}

const rownums = new Map();
{
	const t = document.querySelector('#outdata tbody');
	const colcount = document.querySelectorAll('#outdata thead tr th').length;
	{
		const rownames = ['Q', 'R', 'X', 'T', 'P'];
		let rowdata;
		for (let i=0;i<rownames.length;++i){
			rowdata = randArray(colcount);
			rowdata[0] = rownames[i];
			rowCols(t.insertRow(-1), colcount, rowdata);
			rownums.set(rownames[i], i);
		}
	}
}

function data2row(tablerow, colMap, data){
	const cols = tablerow.querySelectorAll('td');
	for (const key of colMap.keys()){
		if (key in data){
			cols[colMap.get(key)].textContent = data[key];
		}
	}
}

function gotData(data, outtable, rownums, colnums, rowdesc){
	// where data is an array of rows with cols present in colnums
	const rows = outtable.querySelectorAll('tbody tr');
	for (let d=0;d<data.length;++d){
		if (rownums.has(data[d][rowdesc])){
			data2row(rows[rownums.get(data[d][rowdesc])], colnums, data[d]);
		}
	}
}
function genData(){
	const data = [];

	const rownames = ['Q', 'R', 'X', 'T', 'P'];
	const colcount = document.querySelectorAll('#outdata thead tr th').length;
	let row;
	for (let i=0;i<rownames.length;++i){
		row = {'Lane' : rownames[i]};
		for (const key of colnums.keys()){
			row[key] = Math.random();
		}
		data.push(row);
	}

	return data;
}
function rb(){
	const data = genData();
	gotData(
		data, outdata, rownums, colnums, 'Lane'
	);
}
</script>
<script src='fixedtable.js'></script>
<table id='xtable'>
<thead>
<tr>
	<th>rowkey</th>
	<th>C0</th>
	<th>C1</th>
	<th>C2</th>
	<th>C3</th>
</tr>
</thead>

</table>
<script>
	const rowenum = new Map([
		['R0',0],
		['R1',1],
		['R2',2]
	]);

	const colenum = new Map([
		['C0',1],
		['C1',2],
		['C2',3],
		['C3',4]
	]);

	xtable.rb = new TableBodyManip(tableBodyDom(rowenum,colenum.size), rowenum, colenum, 'rowkey');
	xtable.appendChild(xtable.rb.tbody);
	xtable.rb.
		setRow({'rowkey': 'R1', 'C0': 11, 'C1': 31, 'C2': 51, 'C3': 101}).
		setRow({'rowkey': 'R0', 'C0': 10, 'C1': 30, 'C2': 50, 'C3': 100}).
		setRow({'rowkey': 'R2', 'C0': 0, 'C1': 3, 'C2': 5, 'C3': 10});
</script>
